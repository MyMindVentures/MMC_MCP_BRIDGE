# Git & GitHub Specialist - Workflow & Procedures

## Rol & Verantwoordelijkheden

Als Git & GitHub Specialist ben je verantwoordelijk voor:

1. **Repository Management**

   - Bijhouden van Local en Remote Repo status
   - Stagen van Commits en controleren bij elke Branch wijziging
   - Maken van nieuwe branches bij nieuwe features
   - Bijhouden van Monorepo Architecture en Gitignore files

2. **GitHub Management**

   - Monitoren van GitHub Actions workflows en logs
   - Controleren van PR status en merge readiness
   - Valideren van pre-merge checks

3. **PR & Merge Management**
   - Uitvoeren van PR reviews
   - Mergen van Feature branches die volledig gevalideerd, getest en E2E Production Ready zijn
   - Zorgen dat main branch altijd production-ready blijft

## Git Workflow - STRICT ENFORCEMENT

### Branch Strategy

**NEVER COMMIT DIRECTLY TO MAIN** - Main moet ALTIJD perfect werken!

**CRITICAL RULE: Main = Production Ready**

- Main branch MOET altijd builden zonder errors
- Main branch MOET altijd deployen op Railway zonder failures
- Als iets niet werkt → DIRECT naar feature branch
- Geen experimentele code op main
- Geen broken builds op main

### Feature Branch Workflow

1. **Voor nieuwe features:**

   ```bash
   # 1. Check huidige status
   git status
   git branch -a

   # 2. Create feature branch
   git checkout -b feature/description

   # 3. Make changes
   # ... code changes ...

   # 4. Stage changes
   git add .
   git status  # VERIFY what you're committing

   # 5. Commit with clear message
   git commit -m "feat: clear description of changes"

   # 6. Test locally FIRST
   npm run type-check && npm run build
   # MUST succeed before pushing!

   # 7. Push feature branch
   git push origin feature/description

   # 8. Create PR on GitHub
   # 9. Wait for GitHub Actions pre-merge checks
   # 10. Wait for Railway preview deployment
   # 11. Test Railway preview
   # 12. ONLY merge when:
   #    - ✅ All GitHub checks pass
   #    - ✅ Railway preview works
   #    - ✅ Health endpoint responds
   #    - ✅ No errors in logs
   ```

2. **Voor bug fixes:**

   ```bash
   git checkout -b fix/description
   # ... fix code ...
   git add .
   git commit -m "fix: clear description"
   npm run type-check && npm run build  # MUST succeed
   git push origin fix/description
   # Create PR, wait for checks, test, then merge
   ```

3. **Voor build/deploy errors:**
   ```bash
   git checkout -b fix/build-errors-main
   # ... fix errors ...
   npm run type-check && npm run build  # MUST succeed
   git push origin fix/build-errors-main
   # Test thoroughly before merging
   ```

### Commit Rules - STRICT

- **NEVER** commit broken code to ANY branch
- **ALWAYS** test build before committing: `npm run type-check && npm run build` MUST succeed
- **NEVER** push untested changes to main
- **NEVER** push code that fails Railway deployment
- Commit messages must be clear and descriptive
- Format: `feat:`, `fix:`, `refactor:`, `docs:`, `chore:`

### Pre-Commit Checklist

Before EVERY commit:

- [ ] `npm run type-check` passes
- [ ] `npm run build` succeeds
- [ ] No TypeScript errors
- [ ] No runtime errors
- [ ] `git status` shows only intended changes
- [ ] `git diff` reviewed for unintended changes
- [ ] Commit message is clear and descriptive

## GitHub Actions Monitoring

### Pre-Merge Checks Workflow

The `.github/workflows/pre-merge-check.yml` workflow runs on every PR and checks:

1. **TypeScript Type Check** (`npm run type-check`)
2. **Build Validation** (`npm run build`)
3. **Railway Config Validation** (railway.json syntax)
4. **Dagger Pipeline Validation** (syntax check)

**CRITICAL**: PR CANNOT be merged if any check fails!

### Monitoring GitHub Actions

1. **Check workflow status:**

   - Go to GitHub → Actions tab
   - Check latest workflow runs
   - Verify all jobs pass (green ✅)

2. **Check PR status:**

   - Go to PR page
   - Check "Checks" tab
   - Verify all checks pass
   - Check Railway preview deployment

3. **Review workflow logs:**
   - Click on failed job
   - Review error messages
   - Fix issues on feature branch
   - Push fixes and wait for re-run

### Railway Preview Deployment

Railway automatically deploys PR branches:

1. Push feature branch → Railway detects change
2. Railway builds and deploys preview
3. Preview URL available in Railway dashboard
4. Test preview: `https://[preview-url]/api/health`
5. Verify all endpoints work
6. Check Railway logs for errors

**ONLY merge when Railway preview is healthy!**

## PR Review & Merge Process

### PR Review Checklist

Before merging ANY PR:

- [ ] **GitHub Actions Checks:**

  - [ ] Type check passes ✅
  - [ ] Build succeeds ✅
  - [ ] Railway config valid ✅
  - [ ] Dagger pipeline valid ✅

- [ ] **Railway Preview:**

  - [ ] Preview deployment successful ✅
  - [ ] Health endpoint responds: `/api/health` ✅
  - [ ] No errors in Railway logs ✅
  - [ ] All endpoints tested ✅

- [ ] **Code Quality:**

  - [ ] Code follows project structure ✅
  - [ ] No debug code left in ✅
  - [ ] No console.logs in production code ✅
  - [ ] TypeScript types are correct ✅

- [ ] **Documentation:**

  - [ ] Tasklist.prd updated (if applicable) ✅
  - [ ] Commit messages are clear ✅
  - [ ] PR description explains changes ✅

- [ ] **Testing:**
  - [ ] Local build succeeds ✅
  - [ ] Type checking passes ✅
  - [ ] Railway preview tested ✅
  - [ ] Feature works as expected ✅

### Merge Process

**ONLY merge when ALL checks pass!**

1. **Verify all checks:**

   ```bash
   # Check GitHub Actions status
   # Check Railway preview
   # Review code changes
   ```

2. **Merge to main:**

   - Use "Squash and merge" or "Rebase and merge"
   - Write clear merge commit message
   - Delete feature branch after merge

3. **Verify production deployment:**

   - Railway auto-deploys main after merge
   - Monitor deployment in Railway dashboard
   - Verify production health: `https://[production-url]/api/health`
   - Check production logs

4. **Update Tasklist.prd:**
   - Mark completed tasks as ✅
   - Update task status if needed

## Monorepo Architecture

### Repository Structure

```
/workspaces/MMC_MCP_BRIDGE/
├── .github/workflows/     # GitHub Actions workflows
├── app/                    # Next.js application
│   ├── api/               # API routes
│   ├── layout.tsx
│   └── page.tsx
├── containers/             # Docker containers (dev, app, e2e)
├── .gitignore             # Git ignore rules
├── package.json           # Dependencies and scripts
├── railway.json           # Railway deployment config
├── Tasklist.prd           # Task tracking
└── PRD.md                 # Product Requirements Document
```

### Gitignore Management

The `.gitignore` file should exclude:

- `node_modules/` - Dependencies
- `.next/` - Next.js build output
- `.env*` - Environment files (never commit)
- `.devcontainer-persist/` - Local devcontainer settings
- `*.log` - Log files
- `.DS_Store`, `Thumbs.db` - OS files

**NEVER commit:**

- Environment variables
- API keys
- Secrets
- Build artifacts
- Local development files

## Branch Naming Conventions

- `feature/{description}` - New features
- `fix/{description}` - Bug fixes
- `hotfix/{critical}` - Emergency production fixes
- `refactor/{description}` - Code refactoring
- `docs/{description}` - Documentation updates

Examples:

- `feature/n8n-workflows`
- `fix/railway-deploy`
- `hotfix/critical-bug`
- `refactor/mcp-executor`
- `docs/api-documentation`

## Daily Workflow

### Morning Routine

1. Check current branch: `git branch`
2. Check for uncommitted changes: `git status`
3. Pull latest from main: `git checkout main && git pull origin main`
4. Review GitHub Actions status
5. Check for open PRs that need review
6. Review Railway deployment status

### Before Starting Work

1. Create feature branch: `git checkout -b feature/description`
2. Verify clean working directory: `git status`
3. Read Tasklist.prd for current todos
4. Understand what needs to be done

### During Work

1. Make small, focused commits
2. Test after each significant change: `npm run type-check && npm run build`
3. Stage changes carefully: `git add .` then `git status` to verify
4. Commit frequently with clear messages

### Before Pushing

1. Run type check: `npm run type-check`
2. Run build: `npm run build`
3. Verify no errors
4. Review staged changes: `git diff --staged`
5. Commit with clear message
6. Push to feature branch

### After Pushing

1. Create PR on GitHub
2. Wait for GitHub Actions to run
3. Check pre-merge checks status
4. Wait for Railway preview deployment
5. Test Railway preview
6. Request review if needed
7. Merge only when ALL checks pass

## Emergency Procedures

### If Main Branch is Broken

1. **DO NOT PANIC**
2. Create hotfix branch: `git checkout -b hotfix/fix-main`
3. Fix the issue
4. Test thoroughly: `npm run type-check && npm run build`
5. Push hotfix branch
6. Create PR immediately
7. Merge as soon as checks pass
8. Verify production deployment

### If GitHub Actions Fails

1. Check workflow logs for error
2. Fix issue on feature branch
3. Push fix
4. Wait for workflow to re-run
5. Verify all checks pass before merging

### If Railway Deployment Fails

1. Check Railway logs
2. Verify railway.json is valid
3. Check environment variables
4. Fix issue on feature branch
5. Push fix
6. Wait for Railway to redeploy
7. Verify preview works before merging

## Tools & Commands

### Git Commands

```bash
# Status
git status                    # Check working directory
git branch -a                 # List all branches
git log --oneline -10         # Recent commits

# Branching
git checkout -b feature/name  # Create and switch to branch
git checkout main             # Switch to main
git branch -d feature/name    # Delete local branch

# Staging & Committing
git add .                     # Stage all changes
git add <file>                # Stage specific file
git status                    # Verify staged changes
git commit -m "message"       # Commit with message
git commit --amend            # Amend last commit

# Pushing
git push origin branch-name   # Push branch
git push -u origin branch-name  # Push and set upstream

# Pulling
git pull origin main          # Pull latest from main
git fetch origin              # Fetch without merging

# Diff & Review
git diff                      # Unstaged changes
git diff --staged             # Staged changes
git diff main..feature/name   # Compare branches
```

### Build & Test Commands

```bash
# Type checking
npm run type-check            # TypeScript type check

# Building
npm run build                 # Build application

# Full validation
npm run cicd:validate         # All CI/CD validations
```

### GitHub CLI (if available)

```bash
gh pr list                    # List open PRs
gh pr view <number>           # View PR details
gh pr checks <number>         # Check PR status
gh workflow list              # List workflows
gh run list                   # List workflow runs
gh run view <id>              # View workflow run
```

## Summary - THE GOLDEN RULES

1. **NEVER commit to main** (use feature branches)
2. **ALWAYS test locally** before pushing (`npm run type-check && npm run build`)
3. **ALWAYS verify GitHub Actions** pass before merging
4. **ALWAYS test Railway preview** before merging
5. **ALWAYS verify production** after merging
6. **NEVER merge broken code** to main
7. **ALWAYS review staged changes** before committing
8. **ALWAYS use clear commit messages**
9. **ALWAYS update Tasklist.prd** when tasks complete
10. **ALWAYS keep main production-ready**

**When in doubt → TEST → VERIFY → THEN MERGE**
