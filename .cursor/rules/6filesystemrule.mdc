---
alwaysApply: true
---

# CODING AGENT INSTRUCTIONS – STRICT PROJECT RULES

## 0. Overall Goal

You are assisting in a **minimal, production-focused full-stack Next.js app** deployed on **Railway** using **Code-as-Config** (`railway.json`) and **Railpack**.

The PRIMARY goal:
- Keep the repository **radically minimal**.
- **Do NOT introduce complexity, new files, or new directories** unless the user explicitly requests it.
- Everything must work with **Railway auto-build + railway.json**, without Dockerfiles or external CI/CD.

If there is ever a conflict between these rules and your “best practices”, **THESE RULES WIN.**


## 1. Technology & Architecture

- Framework: **Next.js (App Router)**
- Language: **TypeScript** (but you may assume `.tsx` / `.ts`)
- Hosting: **Railway** with:
  - `railway.json` as Code-as-Config
  - Railpack as builder
- Full-stack in a single app:
  - Frontend: `/app/page.tsx` and other app router routes
  - Backend: `/app/api/**` server routes


## 2. Allowed Files (YOU MAY READ/WRITE THESE)

You are only allowed to create or modify the following files:

1. `package.json`
2. `railway.json`
3. `/app/page.tsx`
4. `/app/api/**` (any files under this directory tree, e.g. `/app/api/hello/route.ts`)
5. A single lockfile:
   - `package-lock.json` OR
   - `pnpm-lock.yaml` OR
   - `yarn.lock`

You may assume the lockfile exists or will be generated by the package manager.  
You may NOT manually create multiple different lockfiles.


## 3. Forbidden Files (DO NOT CREATE OR TOUCH)

YOU MUST NOT create, edit, or suggest creating any of the following, unless the user explicitly asks for it:

- No **Dockerfile**
- No `.github/` folder
- No CI/CD YAML files (GitHub Actions, GitLab CI, etc.)
- No `tsconfig.json`
- No `next.config.js` or `next.config.mjs`
- No `.eslintrc.*`, `.prettierrc.*`, or other lint/format configs
- No `.env`, `.env.local`, `.env.example`, or any other env files
- No extra app structure like:
  - `src/`
  - `server/`
  - `api/` outside of `/app/api/`
  - `components/` folder unless explicitly requested
- No `README.md` or documentation files unless explicitly asked
- No miscellaneous config files (Babel, PostCSS, Tailwind, Vite, Webpack, etc.) unless explicitly requested

If you think any of these files would be “best practice”, you must **ignore that urge** unless the user clearly asks for it.


## 4. Directory & Structure Rules

- The **repo root** is minimal and contains only:
  - `package.json`
  - `railway.json`
  - one lockfile
  - `app/` directory
- Inside `/app`:
  - `/app/page.tsx` is the main UI entrypoint.
  - `/app/api/**` contains backend/server routes.
- DO NOT:
  - Move files to new folders.
  - Introduce new top-level directories.
  - Restructure the app router without explicit instruction.


## 5. Behavioural Rules

### 5.1 File Creation

- You MUST NOT create any new files outside the **Allowed Files** list.
- If you feel a new file is “needed”, you MUST:
  - Either:
    - Fit the change into one of the allowed files, OR
    - Ask the user explicitly:  
      “This change would require a new file `<name>`. Your current rules say no new files. Do you want to allow this exception?”
- If the user does NOT explicitly grant an exception, you must stick to the minimal set.

### 5.2 Refactoring & Changes

- You MUST NOT:
  - Perform large-scale refactors that change file structure.
  - Introduce architectural patterns that require extra config (e.g. monorepo tooling, complex aliases, custom webpack).
- You MAY:
  - Refactor within **existing, allowed files**.
  - Improve code quality, as long as you don’t violate the file and structure rules.

### 5.3 Dependencies & Scripts

- You MAY add dependencies in `package.json` **only if**:
  - They are strictly necessary for the feature requested.
  - They do not require extra config files from the forbidden list.
- You MUST keep scripts in `package.json` minimal, typically:
  - `"dev": "next dev"`
  - `"build": "next build"`
  - `"start": "next start -p $PORT"`
- Do NOT add lint/format scripts, test runners, or other tooling unless the user explicitly asks.

### 5.4 Railway Integration

- `railway.json` is the **single source of truth** for build & deploy commands.
- Typical baseline (adapt, but don't overcomplicate):

  ```json
  {
    "$schema": "https://railway.com/railway.schema.json",
    "build": {
      "builder": "RAILPACK",
      "buildCommand": "npm install && npm run build"
    },
    "deploy": {
      "startCommand": "npm run start",
      "healthcheckPath": "/",
      "restartPolicyType": "ALWAYS"
    }
  }
  ```

## 6. MCP Bridge Architecture

This project IS an **MCP Bridge** - it acts as a server that Cursor IDE connects to as an MCP client.

### 6.1 Purpose

- **Cursor IDE** (MCP Client) connects via SSE to this bridge
- **This Bridge** orchestrates 24+ MCP servers (git, filesystem, playwright, n8n, mongodb, linear, railway, github, openai, anthropic, etc.)
- **End Result**: Cursor can use all 24 MCP servers through a single SSE connection

### 6.2 Key Endpoints

- `/api/sse` - SSE endpoint for MCP protocol (Cursor connects here)
- `/api/health` - Health check showing all enabled servers
- `/api/servers` - List all MCP servers with tools/resources/prompts
- `/api/mcp/[server]/[tool]` - Execute specific MCP tool

### 6.3 Cursor Configuration

Users configure Cursor IDE to connect to this bridge:

```json
{
  "mcpServers": {
    "MMC-MCP-Bridge": {
      "type": "sse",
      "url": "https://mmcmcphttpbridge-production.up.railway.app/api/sse"
    }
  }
}
```

### 6.4 MCP Protocol Compliance

- Uses **MCP JSON-RPC 2.0** over SSE
- Implements: `server/info`, `tools/list`, `resources/list`, `prompts/list`, `tools/call`
- Compatible with Apollo MCP Server spec
- All 24 servers ALWAYS enabled (throw error if env var missing)
