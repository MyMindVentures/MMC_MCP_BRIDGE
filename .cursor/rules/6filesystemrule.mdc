---
alwaysApply: true
---

# CODING AGENT BEHAVIOR RULES – STRICT ENFORCEMENT

## 0. Core Principle

**RADICAL MINIMALISM** - Every file, every line, every dependency must be justified.

If there is ever a conflict between these rules and your "best practices", **THESE RULES WIN.**

**NEVER** assume the user wants:

- Extra config files
- Documentation files
- Helper scripts
- "Best practice" folder structures

**ALWAYS** ask first if not explicitly requested.

## 1. Git Workflow - MANDATORY

### 1.1 Branch Strategy

**NEVER COMMIT DIRECTLY TO MAIN** (except critical hotfixes)

**ALWAYS:**

1. Create feature branch: `git checkout -b feature/description` or `fix/description`
2. Make ALL changes on feature branch
3. Test locally: `npm run build` MUST succeed
4. Commit with clear message
5. Push feature branch: `git push origin feature/description`
6. **ONLY** merge to main when feature is complete and tested
7. Delete feature branch after merge

**Branch Naming:**

- `feature/{description}` - New features
- `fix/{description}` - Bug fixes
- `hotfix/{critical}` - Emergency production fixes

### 1.2 Commit Rules

- **NEVER** commit broken code to ANY branch
- **ALWAYS** test build before committing
- **NEVER** push untested changes to main
- Commit messages must be clear and descriptive

### 1.3 Debugging/Experimentation

When debugging or trying new things:

1. Create a `fix/` or `experiment/` branch
2. Test thoroughly
3. Only merge when confirmed working
4. **NEVER** use main as testing ground

## 2. File System Rules - STRICT

### 2.1 Allowed Files (ONLY THESE)

You MAY create/modify:

1. `package.json` - Dependencies and scripts
2. `railway.json` - Deployment config (Railway only)
3. `README.md` - Documentation (if explicitly requested)
4. `/app/page.tsx` - Frontend entry point
5. `/app/api/**/*.ts` - Backend API routes (Next.js App Router)
6. ONE lockfile: `package-lock.json` OR `pnpm-lock.yaml` OR `yarn.lock`
7. `tsconfig.json` - TypeScript config (required by Next.js)
8. `next-env.d.ts` - Next.js TypeScript types (auto-generated, may exist in repo)
9. `.devcontainer/**` - Devcontainer config (Dockerfile + devcontainer.json) when explicitly requested
10. `.vscode/**` and `.cursor/**` - Editor/Workspace settings for VS Code / Cursor
11. `Tasklist.prd` - Task list / PRD file for project management

### 2.2 Auto-Generated Files (IGNORE/DELETE)

These are auto-generated by Next.js or tooling and should **NOT** be edited manually, but some are allowed to live in the repo:

- `tsconfig.json` - Required by Next.js/TypeScript (may be committed, but minimal)
- `next-env.d.ts` - Auto-generated by Next.js (may be committed)
- `.next/` - Build output (**never commit**, always gitignored)
- `node_modules/` - Dependencies (**never commit**, always gitignored)

Ensure `.next/` and `node_modules/` are in `.gitignore`.

### 2.3 FORBIDDEN Files (NEVER CREATE)

**ABSOLUTELY FORBIDDEN** unless user explicitly requests:

❌ **Config Files:**

- `next.config.js` / `next.config.mjs`
- `.eslintrc.*` / `.prettierrc.*`
- `babel.config.js` / `postcss.config.js`
- `tailwind.config.js` / `vite.config.js`
- Any other config files

❌ **CI/CD Files:**

- `.github/workflows/*.yml` (use Railway CI/CD)
- `.gitlab-ci.yml`
- `Dockerfile` / `docker-compose.yml`
- Any CI/CD configuration

❌ **Environment Files:**

- `.env` / `.env.local` / `.env.example`
- Use Railway dashboard for env vars

❌ **Documentation Files:**

- Multiple `.md` files (use README.md only)
- `docs/` folder
- Separate documentation files

❌ **Scripts/Tools:**

- `scripts/` folder
- Helper scripts
- Build scripts (use package.json only)

❌ **Extra Directories:**

- `src/` (use `app/` directly)
- `server/` (use `app/api/`)
- `components/` (unless explicitly requested)
- `lib/` / `utils/` (put in `app/api/` if needed)

**If you think "but this is best practice!"** → **STOP** → **Ask user first**

## 3. Repository Structure - ENFORCED

### 3.1 Root Directory (ONLY THESE)

```
project-root/
├── package.json          ✅ Required
├── package-lock.json     ✅ Required (or pnpm/yarn equivalent)
├── railway.json          ✅ Required (deployment config)
├── README.md             ✅ Optional (if requested)
├── .gitignore            ✅ Required
└── app/                  ✅ Required (Next.js App Router)
    ├── page.tsx          ✅ Frontend
    └── api/              ✅ Backend
        └── **/*.ts       ✅ API routes
```

**NOTHING ELSE AT ROOT LEVEL**

### 3.2 Inside `/app/api/`

- Organize by feature/domain
- Use TypeScript (`.ts`)
- Follow Next.js App Router conventions
- Keep files focused and single-purpose

**Example:**

```
app/api/
├── health/route.ts
├── users/route.ts
├── auth/
│   ├── login/route.ts
│   └── logout/route.ts
└── utils.ts (if shared logic needed)
```

### 3.3 Restructuring Rules

**NEVER:**

- Create new top-level directories
- Move files without explicit instruction
- Introduce complex folder hierarchies
- Create "architecture" for the sake of it

**ALWAYS:**

- Keep structure flat and simple
- Co-locate related code
- Use Next.js conventions

## 4. Behavioral Rules - MANDATORY

### 4.1 Before Creating ANY File

**STOP and ask yourself:**

1. Is this file in the allowed list?
2. Did the user explicitly request this?
3. Can I achieve this without a new file?

**If NO to any → Ask user first**

Example:

> "This would require creating `scripts/deploy.sh`. Your rules forbid this. Should I:
> A) Add the logic to `package.json` scripts instead?
> B) Create an exception for this file?
> C) Find another approach?"

### 4.2 Dependencies

**BEFORE adding ANY dependency:**

1. Is it absolutely necessary?
2. Does it require config files? (If yes → forbidden)
3. Is there a simpler alternative?

**Keep `package.json` scripts minimal:**

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start -p $PORT"
  }
}
```

**NO:**

- Lint scripts
- Format scripts
- Test scripts (unless explicitly requested)
- Custom build scripts

### 4.3 Refactoring

**NEVER:**

- Large-scale refactors without explicit request
- Change file structure "for better organization"
- Introduce design patterns that need extra files
- Split code into multiple files "for cleanliness"

**ALWAYS:**

- Refactor within existing files
- Keep changes minimal and focused
- Maintain existing structure

### 4.4 Railway Deployment

**`railway.json` is the ONLY deployment config**

```json
{
  "$schema": "https://railway.com/railway.schema.json",
  "build": {
    "builder": "RAILPACK",
    "buildCommand": "npm ci && npm run build"
  },
  "deploy": {
    "startCommand": "npm run start",
    "healthcheckPath": "/api/health",
    "restartPolicyType": "ALWAYS"
  }
}
```

**NO Dockerfile, NO GitHub Actions, NO external CI/CD**

Railway provides:

- Auto-build on push
- PR preview deployments
- Environment variables
- Health checks

**Use Railway's built-in features, not custom scripts**

## 5. Testing & Quality - BEFORE MERGE

### 5.1 Local Testing (MANDATORY)

**BEFORE committing to ANY branch:**

```bash
# 1. Build must succeed
npm run build

# 2. No TypeScript errors
# 3. No runtime errors
```

**If build fails → FIX IT → Don't commit broken code**

### 5.2 Railway Preview Testing

When you push a feature branch:

1. Railway auto-deploys preview
2. Wait for deployment (check Railway dashboard)
3. Test preview URL
4. Only merge to main if preview is healthy

### 5.3 Merge Checklist

Before merging to main:

- [ ] Local build succeeds
- [ ] Railway preview is healthy
- [ ] Feature is complete and tested
- [ ] No debug code left in
- [ ] Commit messages are clear

---

## 6. Common Mistakes - AVOID THESE

### ❌ Mistake 1: Committing directly to main

**NEVER** push experimental/debug code to main
**ALWAYS** use feature branches

### ❌ Mistake 2: Creating "helpful" files

Don't create scripts, docs, configs without asking
**ASK FIRST**

### ❌ Mistake 3: Pushing broken builds

**ALWAYS** test `npm run build` before pushing
Main branch must ALWAYS build successfully

### ❌ Mistake 4: Over-engineering

Don't add complexity "for future scalability"
**KEEP IT SIMPLE**

### ❌ Mistake 5: Ignoring auto-generated files

Delete `tsconfig.json` and `next-env.d.ts` if they appear
Add to `.gitignore`

---

## 7. Summary - THE GOLDEN RULES

1. **NEVER commit to main** (use feature branches)
2. **NEVER create files** without checking allowed list
3. **NEVER push broken builds**
4. **ALWAYS test locally** before pushing
5. **ALWAYS ask** if unsure about file creation
6. **KEEP IT MINIMAL** - less is more
7. **USE RAILWAY** for CI/CD (no custom scripts)
8. **ONE README** for all documentation

**When in doubt → ASK THE USER**

---

## 8. Quick Reference

### Allowed Files

✅ `package.json`
✅ `railway.json`
✅ `README.md` (if requested)
✅ `app/page.tsx`
✅ `app/api/**/*.ts`
✅ One lockfile

### Forbidden Files

❌ Config files (tsconfig, eslint, etc.)
❌ CI/CD files (.github, Dockerfile)
❌ Environment files (.env)
❌ Scripts folder
❌ Multiple markdown files
❌ Extra directories (src/, lib/, etc.)

### Git Workflow

1. Create feature branch
2. Make changes
3. Test build locally
4. Push feature branch
5. Test Railway preview
6. Merge to main (only if healthy)
7. Delete feature branch

### When Unsure

**STOP → ASK USER → DON'T ASSUME**
