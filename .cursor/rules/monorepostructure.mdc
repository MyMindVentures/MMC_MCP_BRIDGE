---
alwaysApply: true
---
# MMC MCP Bridge - Monorepo Structuur

## Overzicht

Deze monorepo bevat 3 onafhankelijke containers voor verschillende doeleinden:

1. **Development Container** (`containers/dev/`) - Voor app development
2. **E2E Test Container** (`containers/e2e/`) - Voor testing en validatie
3. **Full Stack App Container** (`containers/app/`) - Productie-ready applicatie

## Directory Structuur

```
/workspaces/MMC_MCP_BRIDGE/
├── containers/
│   ├── dev/                    # Development Container
│   │   ├── Dockerfile          # Development image (node:22.3.0-alpine)
│   │   ├── build.sh            # Build script
│   │   └── README.md           # Documentatie
│   ├── e2e/                    # E2E Test Container
│   │   ├── Dockerfile          # E2E test image (node:22.3.0-alpine + Playwright)
│   │   ├── build.sh            # Build script
│   │   └── README.md           # Documentatie
│   └── app/                    # Full Stack App Container
│       ├── Dockerfile          # Production image (multi-stage build, node:22.3.0-alpine)
│       ├── build.sh            # Build script
│       └── README.md           # Documentatie
├── app/                        # Next.js applicatie code
│   ├── api/                    # API routes
│   ├── layout.tsx
│   └── page.tsx
├── docker-compose.yml          # Alle 3 containers configuratie
├── package.json                # NPM scripts voor alle containers
└── ...
```

## Containers

### 1. Development Container (`dev`)

**Doel**: Development van de app met hot-reload en debugging

**Features**:

- Hot-reload tijdens development
- Volledige debugging capabilities
- Doppler CLI voor secrets management
- Git support voor version control

**Port**: 3000

**Start**:

```bash
docker compose up -d dev
# of
npm run docker:dev:up
```

### 2. E2E Test Container (`e2e`)

**Doel**: End-to-end testing, validatie en debugging

**Features**:

- Playwright voor browser testing
- Chromium browser (system)
- CI/CD ready
- Onafhankelijk van andere containers

**Start**:

```bash
docker compose up -d e2e
# of
npm run docker:e2e:up
```

### 3. Full Stack App Container (`app`)

**Doel**: Productie-ready deployment van de volledige applicatie

**Features**:

- Multi-stage build voor optimalisatie
- Production mode
- Geoptimaliseerd voor performance
- Health checks

**Port**: 3001 (om conflicten met dev te voorkomen)

**Start**:

```bash
docker compose up -d app
# of
npm run docker:app:up
```

## Docker Compose Commando's

### Alle containers

```bash
docker compose up -d --build        # Start alle containers
docker compose down                 # Stop alle containers
docker compose logs -f              # Logs van alle containers
```

### Individuele containers

```bash
# Development
docker compose up -d dev
docker compose logs -f dev
docker compose stop dev

# E2E
docker compose up -d e2e
docker compose logs -f e2e
docker compose stop e2e

# App
docker compose up -d app
docker compose logs -f app
docker compose stop app
```

## NPM Scripts

```bash
# Development
npm run docker:dev:up       # Start dev container
npm run docker:dev:down     # Stop dev container
npm run docker:dev:logs     # View dev logs

# E2E
npm run docker:e2e:up       # Start e2e container
npm run docker:e2e:down     # Stop e2e container
npm run docker:e2e:logs     # View e2e logs

# App
npm run docker:app:up       # Start app container
npm run docker:app:down     # Stop app container
npm run docker:app:logs     # View app logs

# All
npm run docker:up           # Start alle containers
npm run docker:down         # Stop alle containers
npm run docker:logs         # View alle logs
npm run docker:build:all    # Build alle containers
```

## Container Onafhankelijkheid

Alle 3 containers zijn volledig onafhankelijk:

- Geen `depends_on` dependencies
- `restart: "no"` - starten alleen handmatig
- Eigen netwerk configuratie
- Eigen volumes en environment variables

## Ports

- **Dev Container**: 3000
- **App Container**: 3001 (om conflicten te voorkomen)
- **E2E Container**: Geen externe ports (alleen intern)

## Dockerfiles Overzicht

### Development Container (`containers/dev/Dockerfile`)

- **Base Image**: `node:22.3.0-alpine`
- **Doel**: Development met hot-reload
- **Features**: Doppler CLI, Git, wget, curl, bash
- **Port**: 3000
- **Command**: `npm run dev:host`

### E2E Test Container (`containers/e2e/Dockerfile`)

- **Base Image**: `node:22.3.0-alpine`
- **Doel**: End-to-end testing
- **Features**: Playwright, Chromium (system), Git
- **Command**: `npm run test:e2e`

### Full Stack App Container (`containers/app/Dockerfile`)

- **Base Image**: `node:22.3.0-alpine` (multi-stage)
- **Doel**: Productie deployment
- **Build Stages**:
  - Builder: Installeert dependencies en bouwt applicatie
  - Runner: Alleen runtime dependencies en built code
- **Port**: 3001 (externe), 3000 (interne)
- **Command**: `npm run start`

## MCP Client Configuratie

De MCP client in Cursor is geconfigureerd om te verbinden met:

- **Local Dev Container**: `http://localhost:3000/api/sse` (poort 3000 = dev container)
- **Railway Production**: `https://mmcmcphttpbridge-production.up.railway.app/api/sse` (fallback)

**Belangrijk**: Start de dev container eerst voordat je de MCP client gebruikt:

```bash
docker compose up -d dev
```

## Best Practices

1. Gebruik `dev` container voor development
2. Gebruik `e2e` container voor testing
3. Gebruik `app` container voor productie deployments
4. Start containers alleen wanneer nodig (niet automatisch)
5. Gebruik build scripts voor consistente builds
6. Start dev container voor MCP client functionaliteit

