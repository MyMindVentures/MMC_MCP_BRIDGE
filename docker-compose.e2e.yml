services:
  mcp-bridge-e2e:
    build:
      context: .
      dockerfile: .devcontainer/Dockerfile.e2e
    container_name: MMC_MCP_Bridge_E2E
    environment:
      - NODE_ENV=test
      - DAGGER_ENABLED=true
      - DOPPLER_TOKEN=${DOPPLER_TOKEN:-}
      - DOPPLER_PROJECT=${DOPPLER_PROJECT:-mmc-mcp-bridge}
      - DOPPLER_CONFIG=${DOPPLER_CONFIG:-e2e}
      - RAILWAY_TOKEN=${RAILWAY_TOKEN:-}
      - DOCKER_HUB_USERNAME=${DOCKER_HUB_USERNAME:-}
      - DOCKER_HUB_PASSWORD=${DOCKER_HUB_PASSWORD:-}
    env_file:
      - .env.local
    command: sh -c "cd /workspaces/MMC_MCP_BRIDGE && if [ -n \"$$DOPPLER_TOKEN\" ]; then doppler run -- dagger run ./.dagger/pipeline.ts; else dagger run ./.dagger/pipeline.ts; fi"
    restart: "no"

networks:
  default:
    name: mmc-mcp-bridge-network
